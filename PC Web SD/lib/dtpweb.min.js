!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).dtpweb={})}(this,function(n){"use strict";const d={METHOD_POST:"POST",METHOD_GET:"GET",IP:"127.0.0.1",PORT1:15216,PORT2:35216,TIME_OUT:2e3,OUTER_TIME_OUT:5e3,LABEL_WIDTH:40,LABEL_HEIGHT:30,FONT_NAME:"黑体",FONT_HEIGHT:3.5,LINE_WIDTH:.35,DASH_LEN:[.5,.5],CORNER_RADIUS:1.5,RADIUS:5,RECT_WIDTH:20,THRESHOLD:192,PRINT_ACTION:4096},e={LPAPI:"lpapi",LOCAL:"local"},s={DiscoveryPrinters:"DiscoveryPrinters",GetPrinters:"GetPrinters",OpenPrinter:"OpenPrinter",ClosePrinter:"ClosePrinter",IsPrinterOpened:"IsPrinterOpened",IsPrinterOnline:"IsPrinterOnline",GetPrinterName:"GetPrinterName",ShowProperty:"ShowProperty",PrintImage:"PrintImage",PrintImageD:"PrintImageD",PrintRawData:"PrintRawData",PrintPackage:"PrintPackage",Print:"print",GetParam:"GetParam",SetParam:"SetParam",GetItemOrientation:"GetItemOrientation",SetItemOrientation:"SetItemOrientation",GetItemHorizontalAlignment:"GetItemHorizontalAlignment",SetItemHorizontalAlignment:"SetItemHorizontalAlignment",GetItemVerticalAlignment:"GetItemVerticalAlignment",SetItemVerticalAlignment:"SetItemVerticalAlignment",StartJob:"StartJob",StartPreview:"StartPreview",AbortJob:"AbortJob",CommitJob:"CommitJob",GetJobID:"GetJobID",GetJobInfo:"GetJobInfo",GetPageInfo:"GetPageInfo",GetPageImage:"GetPageImage",StartPage:"StartPage",EndPage:"EndPage",ReturnDrawResult:"ReturnDrawResult",DrawText:"DrawText",Draw1DBarcode:"Draw1DBarcode",Draw2DQRCode:"Draw2DQRCode",Draw2DPdf417:"Draw2DPdf417",Draw2DDataMatrix:"Draw2DDataMatrix",DrawRectangle:"DrawRectangle",FillRectangle:"FillRectangle",DrawRoundRectangle:"DrawRoundRectangle",FillRoundRectangle:"FillRoundRectangle",DrawEllipse:"DrawEllipse",FillEllipse:"FillEllipse",DrawLine:"DrawLine",DrawDashLine:"DrawDashLine",DrawImage:"DrawImage",DrawImageD:"DrawImageD",ServerInfo:"ServerInfo"},h={UrlEncoded:"application/x-www-form-urlencoded;charset=UTF-8",Base64:"application/octet-stream;encoding=base64",Json:"application/json;charset:utf-8"};var g,c,p,t;n.LPA_ParamID=void 0,(t=n.LPA_ParamID||(n.LPA_ParamID={}))[t.GapType=1]="GapType",t[t.PrintDarkness=2]="PrintDarkness",t[t.PrintSpeed=3]="PrintSpeed",t[t.PrinterDPI=4]="PrinterDPI",n.LPA_GapType=void 0,(t=n.LPA_GapType||(n.LPA_GapType={}))[t.Unset=255]="Unset",t[t.None=0]="None",t[t.Hole=1]="Hole",t[t.Gap=2]="Gap",t[t.Black=3]="Black",n.LPA_PrintSpeed=void 0,(t=n.LPA_PrintSpeed||(n.LPA_PrintSpeed={}))[t.Unset=255]="Unset",t[t.Min=0]="Min",t[t.Low=1]="Low",t[t.Normal=2]="Normal",t[t.High=3]="High",t[t.Max=4]="Max",n.LPA_PrintDarkness=void 0,(t=n.LPA_PrintDarkness||(n.LPA_PrintDarkness={}))[t.Unset=255]="Unset",t[t.Min=0]="Min",t[t.Low=3]="Low",t[t.Normal=5]="Normal",t[t.High=9]="High",t[t.Max=14]="Max",n.LPA_ItemAlignment=void 0,(t=n.LPA_ItemAlignment||(n.LPA_ItemAlignment={}))[t.Start=0]="Start",t[t.Center=1]="Center",t[t.End=2]="End",t[t.Stretch=3]="Stretch",t[t.Expand=4]="Expand",n.LPA_FontStyle=void 0,(t=n.LPA_FontStyle||(n.LPA_FontStyle={}))[t.Regular=0]="Regular",t[t.Bold=1]="Bold",t[t.Italic=2]="Italic",t[t.BoldItalic=3]="BoldItalic",t[t.Underline=4]="Underline",t[t.Strikeout=8]="Strikeout",n.LPA_JobNames=void 0,(t=n.LPA_JobNames||(n.LPA_JobNames={})).Preview="#!#Preview#!#",t.Transparent="#!#Transparent#!#",t.Print="dtpweb",n.LPA_PrintActions=void 0,(t=n.LPA_PrintActions||(n.LPA_PrintActions={}))[t.PrintData=1]="PrintData",t[t.PrevBase64=2]="PrevBase64",t[t.PrevUrl=4]="PrevUrl",t[t.Transparent=128]="Transparent",t[t.TransBase64=130]="TransBase64",t[t.Print=4096]="Print",(t=g=g||{})[t.OK=0]="OK",t[t.PARAM_ERROR=1]="PARAM_ERROR",t[t.SYSTEM_ERROR=2]="SYSTEM_ERROR",t[t.NOSUPPORTED_PRINTER=3]="NOSUPPORTED_PRINTER",t[t.UNSUPPORTED_PRINTER=4]="UNSUPPORTED_PRINTER",t[t.NOPRINTDATA=5]="NOPRINTDATA",t[t.NOPAGEDIMENSION=6]="NOPAGEDIMENSION",t[t.INVALID_FILE=7]="INVALID_FILE",t[t.UNSUPPORTED_FUNCTION=8]="UNSUPPORTED_FUNCTION",t[t.INVALID_FONTNAME=9]="INVALID_FONTNAME",t[t.NETWORK_FAILD=90]="NETWORK_FAILD",t[t.NETWORK_TIMEOUT=91]="NETWORK_TIMEOUT",t[t.NETWORK_ERROR=92]="NETWORK_ERROR",t[t.NETWORK_ABORT=93]="NETWORK_ABORT",t[t.NETWORK_UNSUPPORT=94]="NETWORK_UNSUPPORT",t[t.NETWORK_EXCEPTION=95]="NETWORK_EXCEPTION",(t=c=c||{})[t.Local=1]="Local",t[t.Net=2]="Net",t[t.Wifi=3]="Wifi",(t=p=p||{})[t.UrlEncoded=0]="UrlEncoded",t[t.Base64=1]="Base64",t[t.Json=2]="Json";const P={assignValue(t,e){const n=t||{};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(this.isPlainObject(n[i])&&this.isPlainObject(e[i])?this.assignValue(n[i],e[i]):this.isPlainObject(e[i])?n[i]=this.assignValue({},e[i]):Array.isArray(e[i])?n[i]=e[i].slice():n[i]=e[i]);return n},merge(t,...e){let n=t||{};if(e)for(let t=0;t<e.length;t++)n=this.assignValue(n,e[t]);return n},isObject(t){return null!==t&&"object"==typeof t},isPlainObject(t){if("[object Object]"!==toString.call(t))return!1;t=Object.getPrototypeOf(t);return null===t||t===Object.prototype},isFunction(t){return"[object Function]"===toString.call(t)},isStream(t){return this.isObject(t)&&this.isFunction(t.pipe)},isArrayBuffer(t){return"[object ArrayBuffer]"===toString.call(t)},isArray(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},isString(t){return"string"==typeof t},isNumber(t){return"number"==typeof t},isHttpsRequest(t){return/https:?/.test(t)},parseArray(e,n=1){const i=[];if(P.isArray(e))return e;if("string"==typeof e)return e.split(",");if("number"==typeof e)for(let t=0;t<n;t++)i.push(e);return i},parseMargin(t){var e,n;let i=[];return t.margin&&(1===(i=P.parseArray(t.margin,4)).length?i=[i[0],i[0],i[0],i[0]]:2===i.length?i=[i[0],i[1],i[0],i[1]]:3===i.length&&i.push(i[1])),t.marginH&&(e=P.parseArray(t.marginH,2),i[1]=null!=(n=e[0])?n:0,i[3]=null!=(n=e[1])?n:e[0]),t.marginV&&(n=P.parseArray(t.marginV,2),i[0]=null!=(e=n[0])?e:0,i[2]=null!=(t=n[1])?t:n[0]),i},getParamString(t){const e=[];for(const i in t=t||{}){var n=t[i];null!=n&&"object"!=typeof n&&"function"!=typeof n&&e.push(i+"="+encodeURIComponent(n))}return 0<e.length?e.join("&"):""},getRequestData(e,n){if(null==n?n=[]:"object"!=typeof n&&(n=[n]),n.length&&"object"==typeof n[0])return n[0];const i={};if(!((e="string"==typeof e?[e]:e).length<1)&&e[0])for(let t=0;t<e.length;t++)i[e[t]]=n[t];return i},buildURL(t,e){e="string"==typeof e?e:this.getParamString(e);return e?t+":"+e:t},request(t,e){"undefined"!=typeof XMLHttpRequest?this.requestXMLHttp(t,e):"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)?this.requestNodeHttp(t,e):e({statusCode:g.NETWORK_UNSUPPORT,resultInfo:"not supported http request environment!"})},requestXMLHttp(t,e){let n=new XMLHttpRequest;var i=t.host||d.IP,r=t.port||d.PORT1,i=t.baseUrl||`http://${i}:`+r,a=t.data,s=t.headers;let o;t.url&&"/"===t.url[0]&&(t.url=t.url.substring(1));r=i+"/"+t.url;try{n.open(t.method||d.METHOD_GET,r,!t.sync),t.timeout&&!t.sync&&(n.timeout=t.timeout);const u=()=>{n&&(o=200===n.status?JSON.parse(n.responseText):{statusCode:g.NETWORK_FAILD,resultInfo:n.responseText},e(o),n=null)};if("onloadend"in n?n.onloadend=u:n.onreadystatechange=function(){n&&4===n.readyState&&(0!==n.status||n.responseURL&&0===n.responseURL.indexOf("file:"))&&setTimeout(u)},n.onabort=function(){n&&(e({statusCode:g.NETWORK_ABORT,resultInfo:"Request aborted!"}),n=null)},n.onerror=function(){e({statusCode:g.NETWORK_ERROR,resultInfo:"Network Error"}),n=null},n.ontimeout=function(){e({statusCode:g.NETWORK_TIMEOUT,resultInfo:t.timeout?`timeout of ${t.timeout}ms exceeded`:"timeout exceeded"}),n=null},s&&"setRequestHeader"in n)for(var l in s)void 0===a&&"content-type"===l.toLowerCase()?delete s[l]:n.setRequestHeader(l,s[l]);n.send(a)}catch(t){e({statusCode:g.NETWORK_EXCEPTION,resultInfo:t})}},requestNodeHttp(t,e){const n=require("http");t.url&&"/"!==t.url[0]&&(t.url="/"+t.url);var i={host:t.host||d.IP,port:t.port||d.PORT1,method:t.method||d.METHOD_GET,path:t.url,headers:t.headers};let r="";const a=n.request(i,function(t){t.on("data",t=>{r+=t}),t.on("end",()=>{let t={statusCode:g.NETWORK_EXCEPTION,resultInfo:r};try{t=JSON.parse(r)}catch(t){console.log(t)}e(t)}),t.on("error",t=>{n.aborted||e({statusCode:g.NETWORK_ERROR,resultInfo:t})})});a.on("error",t=>{e({statusCode:g.NETWORK_FAILD,resultInfo:t})}),a.on("socket",t=>{t.setKeepAlive(!0,6e4)}),t.timeout&&(i=t.timeout,a.setTimeout(i,()=>{a.destroy(),e({statusCode:g.NETWORK_TIMEOUT,resultInfo:t.timeout?`timeout of ${t.timeout}ms exceeded`:"timeout exceeded"})})),a.end(t.data)},unitConvert(t){return t&&100*t},poundToMm(t){return 25.4*t/72},mmToPound(t){return 72*t/25.4},unitConvertOfDrawBase(t,e){var e=e||[],n=e[3]||0,i=e[0]||0,r=e[4]||0,e=e[5]||0,a=(t=t||{}).x||0,s=t.y||0;return t.x=this.unitConvert(a+n+r),t.y=this.unitConvert(s+i+e),t.width=this.unitConvert(t.width),t.height=this.unitConvert(t.height),t.orientation&&3<t.orientation&&(t.orientation=t.orientation/90),t},unitConvertOfFillRect(t,e){return(t=this.unitConvertOfDrawBase(t,e)).width=t.width||this.unitConvert(d.RECT_WIDTH),t.height=t.height||t.width,t.cornerWidth=this.unitConvert(t.cornerWidth),t.cornerHeight=this.unitConvert(t.cornerHeight)||t.cornerWidth,t},unitConvertOfDrawRect(t,e){return(t=this.unitConvertOfFillRect(t,e)).lineWidth=this.unitConvert(t.lineWidth||d.LINE_WIDTH),t},unitConvertOfLine(e,t){var t=t||[],n=t[3]||0,i=t[0]||0,r=t[4]||0,t=t[5]||0,a=(e=e||{}).x1||0,s=e.y1||0,o=null!=(o=e.x2)?o:a,l=null!=(l=e.y2)?l:s;if(e.x1=this.unitConvert(a+n+r),e.y1=this.unitConvert(s+i+t),e.x2=this.unitConvert(o+n+r),e.y2=this.unitConvert(l+i+t),e.lineWidth=this.unitConvert(e.lineWidth||d.LINE_WIDTH),!e.dashLens&&P.isArray(e.dashLen)?(e.dashLens=e.dashLen,e.dashLen=void 0):e.dashLen||"string"!=typeof e.dashLens||(e.dashLen=e.dashLens,e.dashLens=void 0),"string"==typeof e.dashLen&&(e.dashLens=e.dashLen.split(",")),e.dashLens&&0<e.dashLens.length){1===e.dashLens.length&&e.dashLens.push(e.dashLens[0]);for(let t=0;t<e.dashLens.length;t++)e.dashLens[t]=this.unitConvert(e.dashLens[t]);e.dashLen=e.dashLens.join(","),e.dashCount=e.dashLens.length}return e.orientation&&3<e.orientation&&(e.orientation=e.orientation/90),e},getTimeout(t,e){return t&&0<t?t:e===c.Local?d.TIME_OUT:d.OUTER_TIME_OUT},getAgent(){return navigator.userAgent.toLowerCase()||""},isWin32(){const t=this.getAgent();return t.indexOf("win32")||t.indexOf("wow32")},isWin64(){const t=this.getAgent();return t.indexOf("win64")||t.indexOf("wow64")},isWindows(){const t=this.getAgent();return 0<=t.indexOf("win")||0<=t.indexOf("wow")},isMac(){return/macintosh|mac os x/i.test(this.getAgent())}};let o=void 0;n.DTPWeb=class i{constructor(){this._labelWidth=0,this._labelHeight=0,this._margins=[]}static getApi(e){return this.getInstance(e).checkPlugin(t=>{e&&"function"==typeof e.callback&&e.callback(t)}),this.getInstance()}static getInstance(t){const e=o=o||new i;return e.init(t),e}getIpAddress(t){return t||this._ip||this._initIp}getPort(t){return t||this._port||this._initPort}getDeviceType(t){return t||this._deviceType||c.Local}getFontName(t){return t||this._fontName||d.FONT_NAME}getFontHeight(t){return t||this._fontHeight||d.FONT_HEIGHT}getLineWidth(t){return t||this._lineWidth||d.LINE_WIDTH}getRadius(t){return t||this._radius||d.RADIUS}getCornerWidth(t){return t||this._cornerWidth||d.CORNER_RADIUS}parseMargin(t){this._margins.splice(0);var e=P.parseMargin(t);for(let t=0;t<4;t++)this._margins[t]=+(e[t]||0);return this._margins}setFontName(t){this._fontName=t}setOffsetX(t){this._margins[4]=t}setOffsetY(t){this._margins[5]=t}init(t){(t=t||{}).ip&&(this._initIp=t.ip),t.fontName&&(this._fontName=t.fontName),t.fontHeight&&(this._fontHeight=t.fontHeight),t.lineWidth&&(this._lineWidth=t.lineWidth),t.radius&&(this._radius=t.radius)}async checkPlugin(t){var e;let n=await this.checkPort(d.PORT1);return n=n||await this.checkPort(d.PORT2),e=n,console.log(e?"★★★ 打印助手运行正常 ★★★":"★★★ 未检测到打印助手 ★★★"),t&&t(e),n}async checkPort(i,r){console.log("$$$$ DTPWEB request: checkPort $$$$");const a=this._initIp||d.IP;return o=o||this,new Promise(n=>{P.request({host:a,port:i||this._port,url:e.LOCAL+"/"+s.ServerInfo,sync:!1,timeout:d.TIME_OUT},t=>{console.log("## onResponse: checkPlugin ##"),console.log(t);var e=t=>{"function"==typeof r&&r(t),n(t)};t&&t.statusCode<g.NETWORK_FAILD?(this._initIp||(this._initIp=a),i&&(this._initPort=i),e(this)):e(void 0)})})}async requestApi(t,n=void 0){const i=P.getRequestData(["action"],[t]);console.log(`$$$$ DTPWEB request: ${i.action} $$$$`),console.log(i),n&&console.log(n),n=n||{};let r=i.data||n.data;n.data&&(n.data=void 0);const a=P.getParamString(i.params||n),s=a?"?"+a:"",o=i.control||e.LPAPI,l=this.getDeviceType(i.deviceType),u=P.getTimeout(i.timeout,l);return new Promise(e=>{i.contentType===p.Json?r=JSON.stringify(r||n):i.contentType!==p.Base64&&(r=a);let t=h.UrlEncoded;i.contentType===p.Json?t=h.Json:i.contentType===p.Base64&&(t=h.Base64),P.request({method:"POST",host:this.getIpAddress(l===c.Local?void 0:i.ip),port:this.getPort(i.port),url:o+"/"+i.action+s,params:n,headers:{"Content-type":t},data:r,sync:!1,timeout:u},t=>{console.log(`## onResponse: ${i.action} ##`),console.log(t),e(t)})})}async getItemOrientation(){var t=await this.requestApi(s.GetItemOrientation);return null==t?void 0:t.resultInfo}async setItemOrientation(t){return t=P.getRequestData(["orientation"],[t]),(null==(t=await this.requestApi(s.SetItemOrientation,t))?void 0:t.statusCode)===g.OK}async getItemHorizontalAlignment(){var t=await this.requestApi(s.GetItemHorizontalAlignment);return null==t?void 0:t.resultInfo}async setItemHorizontalAlignment(t){return t=P.getRequestData(["alignment"],[t]),(null==(t=await this.requestApi(s.SetItemHorizontalAlignment,t))?void 0:t.statusCode)===g.OK}async getItemVerticalAlignment(){var t=await this.requestApi(s.GetItemVerticalAlignment);return null==t?void 0:t.resultInfo}async setItemVerticalAlignment(t){return t=P.getRequestData(["alignment"],[t]),(null==(t=await this.requestApi(s.SetItemVerticalAlignment,t))?void 0:t.statusCode)===g.OK}async discoveryPrinters(t){return(null==(t=await this.requestApi(s.DiscoveryPrinters,{mode:null!=t?t:1}))?void 0:t.statusCode)===g.OK}async getPrinters(t){return(t=P.getRequestData(["onlyOnline"],[t])).onlyOnline="boolean"!=typeof t.onlyOnline||t.onlyOnline,t.onlySupported=!0,(null==(t=null==(t=await this.requestApi({action:s.GetPrinters,timeout:5e3},t))?void 0:t.resultInfo)?void 0:t.printers)||[]}async openPrinter(t){var t=P.getRequestData(["name"],[t]),e=await this.requestApi({action:s.OpenPrinter,ip:t.ip||this._initIp,port:t.port||this._initPort,deviceType:t.type||c.Local,timeout:1e4},t);return(null==e?void 0:e.statusCode)===g.OK&&(t.type&&t.type!==c.Local&&(this._ip=t.ip,this._port=t.port,this._deviceType=t.type),!0)}async getPrinterName(){var t;return null==(t=await this.requestApi(s.GetPrinterName))?void 0:t.resultInfo}async isPrinterOpened(){var t;return(null==(t=await this.requestApi(s.IsPrinterOpened))?void 0:t.statusCode)===g.OK}async isPrinterOnline(){var t;return!!P.isWindows()&&(null==(t=await this.requestApi(s.IsPrinterOnline))?void 0:t.statusCode)===g.OK}async closePrinter(){var t;return(null==(t=await this.requestApi(s.ClosePrinter))?void 0:t.statusCode)===g.OK}async showProperty(t){let e;return P.isWindows()&&(t.showDocument="boolean"!=typeof t.showDocument||t.showDocument,e=await this.requestApi(s.ShowProperty,t)),(null===e||void 0===e?void 0:e.statusCode)===g.OK}async getParam(t){return t=P.getRequestData(["id"],[t]),(null==(t=await this.requestApi(s.GetParam,t))?void 0:t.statusCode)===g.OK?t.resultInfo:-1}async setParam(t){return t=P.getRequestData(["id"],[t]),(null==(t=await this.requestApi(s.SetParam,t))?void 0:t.statusCode)===g.OK}async getGapType(){return this.getParam(n.LPA_ParamID.GapType)}async setGapType(t){return this.setParam({id:n.LPA_ParamID.GapType,value:t})}async getPrintDarkness(){return this.getParam(n.LPA_ParamID.PrintDarkness)}async setPrintDarkness(t){return this.setParam({id:n.LPA_ParamID.PrintDarkness,value:t})}async getPrintSpeed(){return this.getParam(n.LPA_ParamID.PrintSpeed)}async setPrintSpeed(t){return this.setParam({id:n.LPA_ParamID.PrintSpeed,value:t})}async getPrinterDPI(){return this.getParam(n.LPA_ParamID.PrinterDPI)}async startJob(t){t=P.getRequestData(["width"],[t]);var e=this.parseMargin(t);return this._labelWidth=t.width||d.LABEL_WIDTH,this._labelHeight=t.height||d.LABEL_HEIGHT,t.scaleUnit=1,t.width=P.unitConvert(t.width+e[1]+e[3]),t.height=P.unitConvert(t.height+e[0]+e[2]),t.jobName=t.jobName||n.LPA_JobNames.Print,(null==(e=await this.requestApi(s.StartJob,t))?void 0:e.statusCode)===g.OK}async startPreview(t){return t=P.getRequestData(["width"],[t]),this._labelWidth=t.width||d.LABEL_WIDTH,this._labelHeight=t.height||d.LABEL_HEIGHT,t.scaleUnit=1,t.width=P.unitConvert(t.width),t.height=P.unitConvert(t.height),(null==(t=await this.requestApi(s.StartPreview,t))?void 0:t.statusCode)===g.OK}async abortJob(){this.requestApi(s.AbortJob)}async commitJob(t){return(null==(t=await this.requestApi(s.CommitJob,t))?void 0:t.statusCode)===g.OK}async getJobID(){var t;return P.isWindows()?null==(t=await this.requestApi(s.GetJobID))?void 0:t.resultInfo:0}async getJobInfo(t){if(P.isWindows())return null==(t=await this.requestApi(s.GetJobInfo,t))?void 0:t.resultInfo}async getPageInfo(){var t=await this.requestApi(s.GetPageInfo);return null==t?void 0:t.resultInfo}async getPageImage(t){return t=P.getRequestData(["page"],[t]),null==(t=await this.requestApi(s.GetPageImage,t))?void 0:t.resultInfo}async startPage(){var t;return(null==(t=await this.requestApi(s.StartPage))?void 0:t.statusCode)===g.OK}async endPage(){var t;return(null==(t=await this.requestApi(s.EndPage))?void 0:t.statusCode)===g.OK}async returnDrawResult(t){const e=P.getRequestData(["returnDrawResult"],[t]);return e.returnDrawResult=null==(t=e.returnDrawResult)||t,(null==(t=await this.requestApi(s.ReturnDrawResult,e))?void 0:t.statusCode)===g.OK}mm2Pound(t){return P.mmToPound(t)}pound2Mm(t){return P.poundToMm(t)}async drawText(n){if(!(n=P.getRequestData(["text"],[n])).text)return!1;if(n.fontHeight=this.getFontHeight(n.fontHeight||n.height),(n=P.unitConvertOfDrawBase(n,this._margins)).fontName=this.getFontName(n.fontName),n.fontHeight=P.unitConvert(n.fontHeight),n.charSpace=P.unitConvert(n.charSpace),"number"==typeof n.lineSpace&&(n.lineSpace=P.unitConvert(n.lineSpace)),n.leadingIndent||(n.leadingIndentChars?(n.leadingIndent=10*n.leadingIndentChars,delete n.leadingIndentChars):n.leadingIndentMM?(.01<=n.leadingIndentMM?n.leadingIndent=100*n.leadingIndentMM+1e3:n.leadingIndentMM<=-.01&&(n.leadingIndent=100*n.leadingIndentMM-1e3),delete n.leadingIndentMM):n.leadingIndentColon&&(n.leadingIndent=1e3,delete n.leadingIndentColon)),0===n.leadingIndent&&delete n.leadingIndent,Array.isArray(n.regionCorners)){for(let t=0;t<n.regionCorners.length;t++)n.regionCorners[t]=P.unitConvert(n.regionCorners[t]);n.regionCorners=n.regionCorners.join(",")}if(!n.regionCorners){const i=[];if(n.regionLeftUpCorner&&(i[0]=n.regionLeftUpCorner,delete n.regionLeftUpCorner),n.regionRightUpCorner&&(i[1]=n.regionRightUpCorner,delete n.regionRightUpCorner),n.regionRightBottomCorner&&(i[2]=n.regionRightBottomCorner,delete n.regionRightBottomCorner),n.regionLeftBottomCorner&&(i[3]=n.regionLeftBottomCorner,delete n.regionLeftBottomCorner),0<i.length){const r=[];for(let t=0;t<4;t++){let e=i[t];if("string"==typeof e&&(e=e.split(",")),r[t]="0,0",Array.isArray(e)){2<e.length&&(e=e.slice(0,2));for(let t=0;t<2;t++)e[t]=P.unitConvert(e[t]||0);r[t]=e.join(",")}}n.regionCorners=r.join(",")}}if(n.regionLeftBorders){let e=n.regionLeftBorders;if("string"==typeof n.regionLeftBorders&&(e=n.regionLeftBorders.split(",")),Array.isArray(e)&&2<e.length){for(let t=0;t<e.length;t++)e[t]=P.unitConvert(e[t]);n.regionLeftBorders=e.join(",")}else delete n.regionLeftBorders}if(n.regionRightBorders){let e=n.regionRightBorders;if("string"==typeof e&&(e=e.split(",")),Array.isArray(e)&&2<e.length){for(let t=0;t<e.length;t++)e[t]=P.unitConvert(e[t]);n.regionRightBorders=e.join(",")}else delete n.regionRightBorders}var t=await this.requestApi(s.DrawText,n);return(null==t?void 0:t.statusCode)===g.OK}async draw1DBarcode(t){return!!(t=P.getRequestData(["text"],[t])).text&&((t=P.unitConvertOfDrawBase(t,this._margins)).textHeight=P.unitConvert(t.textHeight),t.textBarSpace=P.unitConvert(t.textBarSpace),t.fontName=this.getFontName(t.fontName),(null==(t=await this.requestApi(s.Draw1DBarcode,t))?void 0:t.statusCode)===g.OK)}async draw2DQRCode(t){return!!(t=P.getRequestData(["text"],[t])).text&&((t=P.unitConvertOfDrawBase(t,this._margins)).height||(t.height=t.width),(null==(t=await this.requestApi(s.Draw2DQRCode,t))?void 0:t.statusCode)===g.OK)}async draw2DPdf417(t){return!!(t=P.getRequestData(["text"],[t])).text&&(t=P.unitConvertOfDrawBase(t,this._margins),(null==(t=await this.requestApi(s.Draw2DPdf417,t))?void 0:t.statusCode)===g.OK)}async draw2DDataMatrix(t){return!!(t=P.getRequestData(["text"],[t])).text&&(t=P.unitConvertOfDrawBase(t,this._margins),(null==(t=await this.requestApi(s.Draw2DDataMatrix,t))?void 0:t.statusCode)===g.OK)}async drawRectangle(t){return(t=P.getRequestData([],[t])).fill?this.fillRectangle(t):t.cornerWidth||t.cornerHeight?this.drawRoundRectangle(t):(t.lineWidth=this.getLineWidth(t.lineWidth),t=P.unitConvertOfDrawRect(t,this._margins),(null==(t=await this.requestApi(s.DrawRectangle,t))?void 0:t.statusCode)===g.OK)}async fillRectangle(t){return(t=P.getRequestData([],[t])).cornerWidth||t.cornerHeight?this.fillRoundRectangle(t):(t=P.unitConvertOfFillRect(t,this._margins),(null==(t=await this.requestApi(s.FillRectangle,t))?void 0:t.statusCode)===g.OK)}async drawRoundRectangle(t){return(t=P.getRequestData([],[t])).fill?this.fillRoundRectangle(t):(t.cornerWidth=this.getCornerWidth(t.cornerWidth||t.cornerHeight),t.lineWidth=this.getLineWidth(t.lineWidth),t=P.unitConvertOfDrawRect(t,this._margins),(null==(t=await this.requestApi(s.DrawRoundRectangle,t))?void 0:t.statusCode)===g.OK)}async fillRoundRectangle(t){return(t=P.getRequestData([],[t])).cornerWidth=this.getCornerWidth(t.cornerWidth||t.cornerHeight),t=P.unitConvertOfFillRect(t,this._margins),(null==(t=await this.requestApi(s.FillRoundRectangle,t))?void 0:t.statusCode)===g.OK}async drawEllipse(t){return(t=P.getRequestData([],[t])).fill?this.fillEllipse(t):(t.lineWidth=this.getLineWidth(t.lineWidth),t=P.unitConvertOfDrawRect(t,this._margins),(null==(t=await this.requestApi(s.DrawEllipse,t))?void 0:t.statusCode)===g.OK)}async fillEllipse(t){return t=P.getRequestData([],[t]),t=P.unitConvertOfFillRect(t,this._margins),(null==(t=await this.requestApi(s.FillEllipse,t))?void 0:t.statusCode)===g.OK}async drawCircle(t){(t=P.getRequestData([],[t])).fill&&this.fillCircle(t);var e=this.getRadius(t.radius),n=2*e;delete t.radius;const i=t;return i.x=(t.x||0)-e,i.y=(t.y||0)-e,i.width=i.height=n,this.drawEllipse(i)}async fillCircle(t){t=P.getRequestData(["radius"],[t]);var e=this.getRadius(t.radius),n=2*e;const i=t;return i.x=(t.x||0)-e,i.y=(t.y||0)-e,i.width=i.height=n,delete t.radius,this.fillEllipse(i)}async drawLine(t){return 0<((t=P.getRequestData([],[t])).dashLens||t.dashLen||[]).length?this.drawDashLine(t):(t.lineWidth=this.getLineWidth(t.lineWidth),t=P.unitConvertOfLine(t,this._margins),(null==(t=await this.requestApi(s.DrawLine,t))?void 0:t.statusCode)===g.OK)}async drawDashLine(t){return((t=P.getRequestData([],[t])).dashLen||t.dashLens||[]).length<1&&(t.dashLens=d.DASH_LEN),t.lineWidth=this.getLineWidth(t.lineWidth),t=P.unitConvertOfLine(t,this._margins),(null==(t=await this.requestApi(s.DrawDashLine,t))?void 0:t.statusCode)===g.OK}async drawImage(t){return!!(t=P.getRequestData([],[t])).imageFile&&(t=P.unitConvertOfDrawBase(t,this._margins),(null==(t=await this.requestApi(s.DrawImage,t))?void 0:t.statusCode)===g.OK)}async drawImageD(t){if(!(t=P.getRequestData([],[t])).data)return!1;t.threshold=null!=(e=t.threshold)?e:d.THRESHOLD,(t=P.unitConvertOfDrawBase(t,this._margins)).drawWidth=P.unitConvert(t.drawWidth||this._labelWidth),t.drawHeight=P.unitConvert(t.drawHeight||this._labelHeight);var e=await this.requestApi({action:s.DrawImageD,contentType:p.Base64,data:t.data},t);return(null==e?void 0:e.statusCode)===g.OK}async printImage(t){if(!(t=P.getRequestData(["data"],[t])).data)return!1;t.scaleUnit=1,t.printWidth=P.unitConvert(t.printWidth),t.printHeight=P.unitConvert(t.printHeight),t.threshold=null!=(e=t.threshold)?e:d.THRESHOLD,t.jobName=t.jobName||n.LPA_JobNames.Print;var e=await this.requestApi({action:s.PrintImageD,contentType:p.Base64,data:t.data},t);return!!e&&e.statusCode===g.OK}async printRawData(t){return!!(t=P.getRequestData(["data"],[t])).data&&(!!(t=await this.requestApi(s.PrintRawData,t))&&t.statusCode===g.OK)}async printPackage(t){return!!(t=P.getRequestData(["data"],[t])).data&&(!!(t=await this.requestApi(s.PrintPackage,t))&&t.statusCode===g.OK)}async print(t){var e;if(t&&t.jobPages)return e=t.action||d.PRINT_ACTION,t.action&&delete t.action,(e=await this.requestApi({action:s.Print,contentType:p.Json,params:{action:e},data:t}))&&e.statusCode===g.OK?e.resultInfo:void 0}},Object.defineProperty(n,"__esModule",{value:!0})});
